// SPDX-License-Identifier: Apache-2.0
// Copyright 2026 Michael Pozhidaev <msp@luwrain.org>

syntax = "proto3";

option java_multiple_files = true;
option java_package = "alpha4";
option java_outer_classname = "AlphaTesseraProto";
option objc_class_prefix = "A4";

package alpha4;

service Users {
  rpc auth(AuthRequest) returns (AuthReply) {}
}

service Publications {
  rpc get(GetPublicationRequest) returns (GetPublicationReply) {}
  rpc list(ListPublicationsRequest) returns (ListPublicationsReply) {}
  rpc create(CreatePublicationRequest) returns (CreatePublicationReply) {}
  rpc delete(DeletePublicationRequest) returns (DeletePublicationReply) {}
  rpc addSection(AddPublicationSectionRequest) returns (AddPublicationSectionReply) {}
}

enum PublicationType {
  BOOK = 0;
  PAPER = 1;
  THESIS = 2;
  GRADUATION_WORK = 3;
  COURSE_WORK = 4;
}

enum PublicationSectionType {
  MARKDOWN = 0;
  LATEX = 1;
  EQUATION = 2;
  TABLE = 3;
  LISTING = 4;
  METAPOST = 5;
  GNUPLOT = 6;
  PLANTUML = 7;
  GRAPHVIZ_DOT = 8;
  GRAPHVIZ_NEATO = 9;
  GRAPHVIZ_TWOPI = 10;
  GRAPHVIZ_CIRCO = 11;
}

message Publication {
  optional PublicationType type = 1;
  optional int64 id = 2;
  optional string shortRef = 3;
  optional string name = 4;
  optional string subject = 5;
  optional string descr = 6;
  optional string authors = 7;
  optional string title = 8;
  optional string subtitle = 9;
  optional string date = 10;
  optional string location = 11;
  optional string published = 12;
  optional string keywords = 13;
  optional string org = 14;
  optional string stGroup = 15;
  optional string spNum = 16;
  optional string spName = 17;
  optional string svName = 18;
  optional string svDegree = 19;
  optional string svRank = 20;
  optional string isbn = 21;
  optional string copyright = 22;
  optional string udk = 23;
  optional string bbk = 24;
  optional string titlePageTopNote = 25;
  optional string titlePageBottomNote = 26;
  optional string bookType = 27;
  optional int32 numCols = 28;
  optional int32 pageWidth = 29;
  optional int32 pageHeight = 30;
  optional int32 pageTopMargin = 31;
  optional int32 pageLeftMargin = 32;
  optional int32 pageBottomMargin = 33;
  optional int32 pageRightMargin = 34;
  optional PublicationSection abs = 35;
  repeated PublicationSection sects = 100;
  optional int64 creationTimestamp = 500;
  optional int64 modificationTimestamp = 601;
  optional int64 publicationTimestamp = 602;
}

message PublicationSection {
  optional PublicationSectionType type = 1;
  optional int32 index = 2;
  optional string id = 3;
  optional string label = 4;
  optional string listingLang = 5;
  optional string source = 6;
  optional string alternativeSource = 7;
  optional string caption = 8;
}

message GetPublicationRequest {
  enum Mode {
    METADATA = 0;
    PREVIEW = 1;
    FULL = 2;
  }
  string  publ = 1;
  optional Mode mode = 100;
}

message GetPublicationReply {
  enum ErrorCode {  
    NONE = 0;
    ILLEGAL_QUERY = 1;
    NOT_FOUND = 2;
  }
  string resultType = 1;
  optional ErrorCode errorCode = 2;
  optional string errorMessage = 3;
  optional Publication publ = 100;
}

message ListPublicationsRequest {
  optional int32 offset = 1;
  optional int32 limitCount = 2;
}

message ListPublicationsReply {
  enum ErrorCode {
    NONE = 0;
    ILLEGAL_QUERY = 1;
  }
  string resultType = 1;
  optional ErrorCode errorCode = 2;
  optional string errorMessage = 3;
  repeated Publication publ = 100;
}

message CreatePublicationRequest {
  Publication publ = 1;
}

message CreatePublicationReply {
enum ErrorCode {
NONE = 0;
ILLEGAL_QUERY = 1;
LIMIT_EXCEEDED = 2;
}
  string resultType = 1;
  optional ErrorCode errorCode = 2;
  optional string errorMessage = 3;
  optional string publ = 10;
}

message DeletePublicationRequest {
  string publ = 1;
}

message DeletePublicationReply {
enum ErrorCode {
NONE = 0;
ILLEGAL_QUERY = 1;
NOT_FOUND = 2;
}
  string resultType = 1;
  optional ErrorCode errorCode = 2;
  optional string errorMessage = 3;
}

message AddPublicationSectionRequest {
  string publ = 1;
  PublicationSection sect = 100;
}

message AddPublicationSectionReply {
  enum ErrorCode {
    NONE = 0;
    ILLEGAL_QUERY = 1;
    LIMIT_EXCEEDED = 2;
    PUBL_NOT_FOUND = 3;
    SECT_NOT_FOUND = 4;
  }
  string resultType = 1;
  optional ErrorCode errorCode = 2;
  optional string errorMessage = 3;
  optional string sect = 100;
}

message AuthRequest {
  string username = 1;
  string password = 2;
}

message AuthReply {
  enum ErrorCode {
    NONE = 0;
    NO_USERNAME = 1;
    NO_PASSWORD = 2;
    PERMISSION_DENIED = 3;
  }
  string resultType = 1;
  ErrorCode errorCode = 2;
  optional string errorMessage = 3;
  optional string accessToken = 10;
}

